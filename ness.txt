let fullDeck = [];
let ImgCalodes;
let playerCards = []; // Array to hold the player's cards
let botCards = [];

function preload() {
    ImgCalodes = loadImage(`Images/caloda.png`);
    const suitsImages = {
        'Clubs': [],
        'Diamonds': [],
        'Hearts': [],
        'Spades': []
    };
    for (let i = 1; i <= 9; i++) {
        suitsImages['Clubs'].push(loadImage(`Images/Clubs/${i}.png`));
        suitsImages['Diamonds'].push(loadImage(`Images/Diamonds/${i}.png`));
        suitsImages['Hearts'].push(loadImage(`Images/Hearts/${i}.png`));
        suitsImages['Spades'].push(loadImage(`Images/Spades/${i}.png`));
    }

    for (let suit in suitsImages) {
        let suitImages = suitsImages[suit];
        let deck = new Deck(suitImages, suit);
        fullDeck.push(...deck.cards);
    }
}

function setup() {
    createCanvas(900, 800);
    shuffleArray(fullDeck);
    dealCards();
}


function draw() {
    background(0, 128, 0);
    displayDeckCount();
    for (let card of playerCards) {
        card.display();
    }
    for (let card of botCards) {
        card.display();
    }
}
function dealCards() {
    playerCards = fullDeck.slice(0, 6);
    botCards = fullDeck.slice(6, 12); // Make sure to start from the 7th card
    arrangeCards(playerCards, height - 150); // Arrange player cards
    arrangeCards(botCards, 40); // Arrange bot cards
}

function arrangeCards(cardsArray, startY) {
    let startX = (width - (cardsArray.length * 110)) / 2;
    for (let i = 0; i < cardsArray.length; i++) {
        let x = startX + i * 110;
        let y = startY;
        cardsArray[i] = new Card(cardsArray[i].suit, cardsArray[i].value, cardsArray[i].img, x, y);
    }
}


function mousePressed() {
    for (let card of playerCards) {
        if (card.isMouseOver()) {
            card.startDragging();
            return; // Only one card should be draggable at a time
        }
    }
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}



function placeCardInCenter(droppedCard) {
    const centerPositions = calculateCenterPositions();

    // Find the first available position in the center
    for (let pos of centerPositions) {
        if (isPositionEmpty(pos)) {
            // Position the dropped card in the center
            droppedCard.x = pos.x;
            droppedCard.y = pos.y;
            return true;
        }
    }
    // If no available position, the card can't be placed
    return false;
}

function isPositionEmpty(position, tolerance = 10) {
    return !playerCards.some(card => {
        return abs(card.x - position.x) < tolerance && abs(card.y - position.y) < tolerance;
    });
}

function calculateCenterPositions() {
    const positions = [];
    const cardWidth = 105; // Assuming all cards have the same width
    const startX = (width / 2) - (3 * cardWidth) + 50; // Start placing cards from the left of center

    for (let i = 0; i < 6; i++) {
        positions.push({
            x: startX + (i * cardWidth),
            y: (height - cardWidth) / 2 // Adjust the y position as needed
        });
    }
    return positions;
}

function isInCenter(card, tolerance = 50) { // Adjust the tolerance as needed
    let centerX = width / 2;
    let centerY = height / 2;
    let cardCenterX = card.x + card.width / 2;
    let cardCenterY = card.y + card.height / 2;

    // Check if the card's center is within the tolerance range of the canvas's center
    return abs(cardCenterX - centerX) < tolerance && abs(cardCenterY - centerY) < tolerance;
}


function mouseReleased() {
    for (let card of playerCards) {
        if (card.dragging) {
            card.stopDragging();
            // If the card is not in the center, reset its position
            if (!isInCenter(card)) {
                card.resetPosition();
            }
            return; // Exit the loop once the dragging card has been handled
        }
    }
}



function displayDeckCount() {
    let count = fullDeck.length - (playerCards.length + botCards.length); // Update the count
    let imgX = 10; // Position near the left edge, adjust as needed
    let imgY = height / 2 - ImgCalodes.height / 2+200; // Center vertically

    image(ImgCalodes, imgX, imgY, 120, 120); // Display the image
    fill(255);
    noStroke();
    textSize(24);
    textAlign(CENTER, CENTER);
    text(count, imgX + 60, imgY + 140);
}


